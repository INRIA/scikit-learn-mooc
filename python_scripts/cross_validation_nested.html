
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nested cross-validation &#8212; Scikit-learn course</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sklearn_mooc.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sklearn_mooc.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="âœ… Quiz" href="../evaluation/evaluation_quiz_03.html" />
    <link rel="prev" title="Nested cross-validation" href="../evaluation/cross_validation_nested_index.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/scikit-learn-logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Scikit-learn course</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Machine Learning Concepts
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../ml_concepts/slides.html">
   ğŸ“° Introducing machine-learning concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ml_concepts/quiz.html">
   âœ… Quiz
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  The predictive modeling pipeline
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../predictive_modeling_pipeline/predictive_modeling_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../predictive_modeling_pipeline/01_tabular_data_exploration_index.html">
   Tabular data exploration
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="01_tabular_data_exploration.html">
     First look at our dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01_tabular_data_exploration_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01_tabular_data_exploration_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../predictive_modeling_pipeline/01_tabular_data_exploration_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../predictive_modeling_pipeline/02_numerical_pipeline_index.html">
   Fitting a scikit-learn model on numerical data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_introduction.html">
     First model with scikit-learn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_ex_00.html">
     ğŸ“ Exercise 00
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_sol_00.html">
     ğŸ“ƒ Solution for Exercise 00
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_hands_on.html">
     Working with numerical data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_numerical_pipeline_scaling.html">
     Preprocessing for numerical features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../predictive_modeling_pipeline/02_numerical_pipeline_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../predictive_modeling_pipeline/03_categorical_pipeline_index.html">
   Handling categorical data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="03_categorical_pipeline.html">
     Encoding of categorical variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_categorical_pipeline_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_categorical_pipeline_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_categorical_pipeline_column_transformer.html">
     Using numerical and categorical variables together
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_categorical_pipeline_ex_02.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_categorical_pipeline_sol_02.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../predictive_modeling_pipeline/03_categorical_pipeline_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../predictive_modeling_pipeline/wrap_up_quiz.html">
   ğŸ Wrap-up quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../predictive_modeling_pipeline/predictive_modeling_module_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Selecting the best model
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../overfit/overfit_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../overfit/overfit_overfitting_underfitting_index.html">
   Overfitting and underfitting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../overfit/overfitting_vs_under_fitting_slides.html">
     ğŸ“° Overfitting and Underfitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_train_test.html">
     The framework and why do we need it
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../overfit/overfitting_vs_under_fitting_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../overfit/overfit_validation_learning_curves_index.html">
   Validation and learning curves
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../overfit/learning_validation_curves_slides.html">
     ğŸ“° Comparing train and test errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_validation_curve.html">
     Overfit-generalization-underfit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_learning_curve.html">
     Effect of the sample size in cross-validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../overfit/learning_validation_curves_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../overfit/overfit_bias_variance_index.html">
   Bias versus variance trade-off
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../overfit/bias_vs_variance_slides.html">
     ğŸ“° Bias versus Variance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../overfit/bias_vs_variance_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overfit/overfit_wrap_up_quiz.html">
   ğŸ Wrap-up quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overfit/overfit_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Hyperparameters tuning
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../tuning/parameter_tuning_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../tuning/parameter_tuning_manual_index.html">
   Manual tuning
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_manual.html">
     Set and get hyperparameters in scikit-learn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_ex_02.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_sol_02.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tuning/parameter_tuning_manual_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../tuning/parameter_tuning_automated_index.html">
   Automated tuning
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_grid_search.html">
     Hyperparameters tuning by grid-search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_randomized_search.html">
     Hyperparameters tuning by randomized-search
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_nested.html">
     Cross-validation and hyperparameters tuning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_ex_03.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parameter_tuning_sol_03.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tuning/parameter_tuning_automated_quiz.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tuning/parameter_tuning_wrap_up_quiz.html">
   ğŸ Wrap-up quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tuning/parameter_tuning_module_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Linear models
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_models/linear_models_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../linear_models/linear_models_intuitions_index.html">
   Intuitions on linear models
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_models/slides.html">
     ğŸ“° Intuitions on linear models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_models/linear_models_quiz_00.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../linear_models/linear_models_regression_index.html">
   Linear regression
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="linear_regression_without_sklearn.html">
     Linear regression without scikit-learn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_regression_in_sklearn.html">
     Linear regression using scikit-learn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_models/linear_models_quiz_01.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../linear_models/linear_models_non_linear_index.html">
   Modelling with a non-linear relationship data-target
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_ex_02.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_sol_02.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_regression_non_linear_link.html">
     Linear regression with non-linear link between data and target
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_ex_03.html">
     ğŸ“ Exercise 03
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_sol_03.html">
     ğŸ“ƒ Solution for Exercise 03
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_models/linear_models_quiz_02.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../linear_models/linear_models_regularization_index.html">
   Regularization in linear model
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_regularization.html">
     Regularization of linear regression model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_ex_04.html">
     ğŸ“ Exercise 04
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_sol_04.html">
     ğŸ“ƒ Solution for Exercise 04
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_models/linear_models_quiz_03.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../linear_models/linear_models_classification_index.html">
   Linear model for classification
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="logistic_regression.html">
     Linear model for classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_ex_05.html">
     ğŸ“ Exercise 05
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear_models_sol_05.html">
     ğŸ“ƒ Solution for Exercise 05
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="logistic_regression_non_linear.html">
     Beyond linear separation in classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_models/linear_models_quiz_04.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_models/linear_models_wrap_up_quiz.html">
   ğŸ Wrap-up quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../linear_models/linear_models_module_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Decision tree models
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../trees/trees_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../trees/trees_intuitions_index.html">
   Intuitions on tree-based models
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../trees/slides.html">
     ğŸ“° Intuitions on tree-based models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../trees/trees_quiz_00.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../trees/trees_classification_index.html">
   Decision tree in classification
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="trees_classification.html">
     Build a classification decision tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="trees_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="trees_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../trees/trees_quiz_01.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../trees/trees_regression_index.html">
   Decision tree in regression
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="trees_regression.html">
     Decision tree for regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="trees_ex_02.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="trees_sol_02.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../trees/trees_quiz_02.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../trees/trees_hyperparameters_index.html">
   Hyperparameters of decision tree
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="trees_hyperparameters.html">
     Importance of decision tree hyperparameters on generalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../trees/trees_quiz_03.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../trees/trees_wrap_up_quiz.html">
   ğŸ Wrap-up quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../trees/trees_module_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Ensemble of models
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../ensemble/ensemble_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ensemble/ensemble_intuitions_index.html">
   Intuitions on ensemble methods
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../ensemble/slides.html">
     ğŸ“° Intuitions on ensemble of tree-based models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ensemble/ensemble_quiz_00.html">
     âœ… Quiz
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_introduction.html">
     Introductory example to ensemble models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ensemble/ensemble_bootstrap_index.html">
   Ensemble method using bootstrapping
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_bagging.html">
     Bagging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_sol_01.html">
     ğŸ“ƒ Solution of Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_random_forest.html">
     Random forest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_ex_02.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_sol_02.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ensemble/ensemble_quiz_01.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ensemble/ensemble_boosting_index.html">
   Ensemble based on boosting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_adaboost.html">
     Adaptive Boosting (AdaBoost)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_ex_03.html">
     ğŸ“ Exercise 03
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_sol_03.html">
     ğŸ“ƒ Solution for Exercise 03
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_gradient_boosting.html">
     Gradient-boosting decision tree (GBDT)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_ex_04.html">
     ğŸ“ Exercise 04
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_sol_04.html">
     ğŸ“ƒ Solution for Exercise 04
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_hist_gradient_boosting.html">
     Speeding-up gradient-boosting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ensemble/ensemble_quiz_02.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../ensemble/ensemble_hyperparameters_index.html">
   Hyperparameters tuning with ensemble methods
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_hyperparameters.html">
     Hyperparameters tuning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_ex_05.html">
     ğŸ“ Exercise 05
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ensemble_sol_05.html">
     ğŸ“ƒ Solution for Exercise 05
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ensemble/ensemble_quiz_03.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ensemble/ensemble_wrap_up_quiz.html">
   ğŸ Wrap-up quiz
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ensemble/ensemble_module_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Evaluating model performance
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../evaluation/evaluation_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../evaluation/cross_validation_baseline_index.html">
   Comparing a model with simple baselines
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_baseline.html">
     Comparing results with baseline and chance level
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_ex_02.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_sol_02.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../evaluation/evaluation_quiz_01.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../evaluation/cross_validation_choices_index.html">
   Choice of cross-validation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_ex_03.html">
     ğŸ“ Introductory exercise regarding stratification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_stratification.html">
     Stratification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_ex_04.html">
     ğŸ“ Introductory exercise for sample grouping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_grouping.html">
     Sample grouping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_ex_05.html">
     ğŸ“ Introductory exercise for non i.i.d. data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="cross_validation_time.html">
     Non i.i.d. data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../evaluation/evaluation_quiz_02.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="../evaluation/cross_validation_nested_index.html">
   Nested cross-validation
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Nested cross-validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../evaluation/evaluation_quiz_03.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../evaluation/02_metrics.html">
   Introduction of the evaluation metrics
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../evaluation/metrics_classification_index.html">
   Classification metrics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="metrics_classification.html">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="metrics_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="metrics_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../evaluation/evaluation_quiz_04.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../evaluation/metrics_regression_index.html">
   Regression metrics
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="metrics_regression.html">
     Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="metrics_ex_02.html">
     ğŸ“ Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="metrics_sol_02.html">
     ğŸ“ƒ Solution for Exercise 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../evaluation/evaluation_quiz_05.html">
     âœ… Quiz
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../evaluation/evaluation_module_take_away.html">
   Main take-away
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  ğŸš§ Feature selection
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../feature_selection/feature_selection_module_intro.html">
   Module overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="feature_selection_introduction.html">
   Benefits of using feature selection
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../feature_selection/feature_selection_limitation_index.html">
   Caveats of feature selection
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="feature_selection_ex_01.html">
     ğŸ“ Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="feature_selection_sol_01.html">
     ğŸ“ƒ Solution for Exercise 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="feature_selection_limitation_model.html">
     Limitation of selecting feature using a model
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature_selection/feature_selection_module_take_away.html">
   Main take-away
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature_selection/feature_selection_quiz.html">
   âœ… Quiz
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  ğŸš§ Interpretation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="dev_features_importance.html">
   Feature importance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dev_features_importance.html#take-away">
   Take Away
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../interpretation/interpretation_quiz.html">
   âœ… Quiz
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../appendix/datasets_intro.html">
   Datasets description
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="trees_dataset.html">
     The penguins datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../appendix/adult_census_description.html">
     The adult census dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="datasets_california_housing.html">
     The California housing dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="datasets_ames_housing.html">
     The Ames housing dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="datasets_blood_transfusion.html">
     The blood transfusion dataset
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/acknowledgement.html">
   Acknowledgement
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/python_scripts/cross_validation_nested.py"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.py</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/INRIA/scikit-learn-mooc"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/INRIA/scikit-learn-mooc/issues/new?title=Issue%20on%20page%20%2Fpython_scripts/cross_validation_nested.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/INRIA/scikit-learn-mooc/edit/master/python_scripts/cross_validation_nested.py"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="nested-cross-validation">
<h1>Nested cross-validation<a class="headerlink" href="#nested-cross-validation" title="Permalink to this headline">Â¶</a></h1>
<p>In this notebook, we show a pattern called <strong>nested cross-validation</strong> which
should be used when you want to both evaluate a model and tune the
modelâ€™s hyperparameters.</p>
<p>Cross-validation is a powerful tool to evaluate the statistical performance
of a model. It is also used to select the best model from a pool of models.
This pool of models can be the same family of predictor but with different
parameters. In this case, we call this procedure <strong>hyperparameters tuning</strong>.</p>
<p>We could also imagine that we would like to choose among heterogeneous models
that will similarly use the cross-validation.</p>
<p>Before we go into details regarding the nested cross-validation, we will
first recall the pattern used to fine tune a modelâ€™s hyperparameters.</p>
<p>Letâ€™s load the breast cancer dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span>

<span class="n">data</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, weâ€™ll make a minimal example using the utility <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> to find
the best parameters via cross-validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">]}</span>
<span class="n">model_to_tune</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>

<span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model_to_tune</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                      <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(estimator=SVC(), n_jobs=-1,
             param_grid={&#39;C&#39;: [0.1, 1, 10], &#39;gamma&#39;: [0.01, 0.1]})
</pre></div>
</div>
</div>
</div>
<p>We recall that <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> will train a model with some specific parameter
on a training set and evaluate it on testing. However, this evaluation is
done via cross-validation using the <code class="docutils literal notranslate"><span class="pre">cv</span></code> parameter. This procedure is
repeated for all possible combinations of parameters given in <code class="docutils literal notranslate"><span class="pre">param_grid</span></code>.</p>
<p>The attribute <code class="docutils literal notranslate"><span class="pre">best_params_</span></code> will give us the best set of parameters that
maximize the mean score on the internal test sets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The best parameter found are: </span><span class="si">{</span><span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best parameter found are: {&#39;C&#39;: 0.1, &#39;gamma&#39;: 0.01}
</pre></div>
</div>
</div>
</div>
<p>We can now show the mean score obtained using the parameter <code class="docutils literal notranslate"><span class="pre">best_score_</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The mean score in CV is: </span><span class="si">{</span><span class="n">search</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The mean score in CV is: 0.627
</pre></div>
</div>
</div>
</div>
<p>At this stage, one should be extremely careful using this score. The
misinterpretation would be the following: since the score was computed on a
test set, it could be considered our modelâ€™s testing score.</p>
<p>However, we should not forget that we used this score to pick-up the best
model. It means that we used knowledge from the test set (i.e. test score) to
decide our modelâ€™s training parameter.</p>
<p>Thus, this score is not a reasonable estimate of our testing error.
Indeed, we can show that it will be too optimistic in practice. The good way
is to use a â€œnestedâ€ cross-validation. We will use an inner cross-validation
corresponding to the previous procedure shown to optimize the
hyperparameters. We will also include this procedure within an outer
cross-validation, which will be used to estimate the testing error of
our tuned model.</p>
<p>In this case, our inner cross-validation will always get the training set of
the outer cross-validation, making it possible to compute the testing
score on a completely independent set.</p>
<p>We will show below how we can create such nested cross-validation and obtain
the testing score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">KFold</span>

<span class="c1"># Declare the inner and outer cross-validation</span>
<span class="n">inner_cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">outer_cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Inner cross-validation for parameter search</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">model_to_tune</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">inner_cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Outer cross-validation to compute the testing score</span>
<span class="n">test_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">outer_cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The mean score using nested cross-validation is: &quot;</span>
      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_score</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">test_score</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The mean score using nested cross-validation is: 0.627 +/- 0.021
</pre></div>
</div>
</div>
</div>
<p>In the example above, the reported score is more trustful and should be close
to productionâ€™s expected statistical performance.</p>
<p>We will illustrate the difference between the nested and non-nested
cross-validation scores to show that the latter one will be too optimistic in
practice. In this regard, we will repeat several time the experiment and
shuffle the data differently. Besides, we will store the score obtain with
and without the nested cross-validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_score_not_nested</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_score_nested</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">N_TRIALS</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_TRIALS</span><span class="p">):</span>
    <span class="n">inner_cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">outer_cv</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Non_nested parameter search and scoring</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model_to_tune</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
                         <span class="n">cv</span><span class="o">=</span><span class="n">inner_cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">test_score_not_nested</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

    <span class="c1"># Nested CV with parameter optimization</span>
    <span class="n">test_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">outer_cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">test_score_nested</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_score</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>We can merge the data together and make a box plot of the two strategies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">all_scores</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Not nested CV&quot;</span><span class="p">:</span> <span class="n">test_score_not_nested</span><span class="p">,</span>
    <span class="s2">&quot;Nested CV&quot;</span><span class="p">:</span> <span class="n">test_score_nested</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">all_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;whiskers&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;medians&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;caps&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">}</span>
<span class="n">all_scores</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of mean accuracy obtained on the test sets with</span><span class="se">\n</span><span class="s2">&quot;</span>
              <span class="s2">&quot;and without nested cross-validation&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cross_validation_nested_14_0.png" src="../_images/cross_validation_nested_14_0.png" />
</div>
</div>
<p>We observe that the modelâ€™s statistical performance with the nested
cross-validation is not as good as the non-nested cross-validation.</p>
<p>As a conclusion, when optimizing parts of the machine learning pipeline (e.g.
hyperparameter, transform, etc.), one needs to use nested cross-validation to
evaluate the statistical performance of the predictive model. Otherwise, the
results obtained without nested cross-validation are over-optimistic.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./python_scripts"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../evaluation/cross_validation_nested_index.html" title="previous page">Nested cross-validation</a>
    <a class='right-next' id="next-link" href="../evaluation/evaluation_quiz_03.html" title="next page">âœ… Quiz</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By scikit-learn developers<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>